# =============================================================================
# ConfigMaps pour les Dashboards Grafana - Data Platform
# =============================================================================
# Ces dashboards fournissent une vue compl√®te de l'√©tat de la plateforme.
# =============================================================================

---
# Dashboard Vue d'ensemble Data Platform
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-data-platform-overview
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
    app: grafana
data:
  data-platform-overview.json: |
    {
      "annotations": {
        "list": []
      },
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "id": null,
      "links": [],
      "liveNow": false,
      "panels": [
        {
          "gridPos": {"h": 4, "w": 24, "x": 0, "y": 0},
          "id": 1,
          "options": {
            "content": "# üöÄ Data Platform - Vue d'ensemble\n\nBienvenue sur le dashboard de monitoring de votre Data Platform!",
            "mode": "markdown"
          },
          "title": "",
          "type": "text"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"},
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}
            }
          },
          "gridPos": {"h": 6, "w": 6, "x": 0, "y": 4},
          "id": 2,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "sum(kube_pod_status_phase{phase=\"Running\"})", "refId": "A"}],
          "title": "üü¢ Pods Running",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"},
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 1}]}
            }
          },
          "gridPos": {"h": 6, "w": 6, "x": 6, "y": 4},
          "id": 3,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "sum(kube_pod_status_phase{phase=\"Pending\"})", "refId": "A"}],
          "title": "üü° Pods Pending",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"},
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 1}]}
            }
          },
          "gridPos": {"h": 6, "w": 6, "x": 12, "y": 4},
          "id": 4,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "sum(kube_pod_status_phase{phase=\"Failed\"})", "refId": "A"}],
          "title": "üî¥ Pods Failed",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"},
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}
            }
          },
          "gridPos": {"h": 6, "w": 6, "x": 18, "y": 4},
          "id": 5,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "count(kube_namespace_labels)", "refId": "A"}],
          "title": "üìÅ Namespaces",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"unit": "percentunit"}},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 10},
          "id": 6,
          "options": {},
          "targets": [{"expr": "1 - avg(rate(node_cpu_seconds_total{mode=\"idle\"}[5m]))", "legendFormat": "CPU Usage", "refId": "A"}],
          "title": "üìä CPU Cluster",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"unit": "percentunit"}},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 10},
          "id": 7,
          "options": {},
          "targets": [{"expr": "1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)", "legendFormat": "Memory Usage", "refId": "A"}],
          "title": "üìä Memory Cluster",
          "type": "timeseries"
        }
      ],
      "refresh": "30s",
      "schemaVersion": 38,
      "style": "dark",
      "tags": ["data-platform", "overview"],
      "templating": {"list": []},
      "time": {"from": "now-1h", "to": "now"},
      "timepicker": {},
      "timezone": "Europe/Paris",
      "title": "Data Platform - Overview",
      "uid": "data-platform-overview",
      "version": 1,
      "weekStart": "monday"
    }

---
# Dashboard Logs Loki
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-logs
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
    app: grafana
data:
  logs-explorer.json: |
    {
      "annotations": {"list": []},
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "id": null,
      "links": [],
      "liveNow": false,
      "panels": [
        {
          "gridPos": {"h": 3, "w": 24, "x": 0, "y": 0},
          "id": 1,
          "options": {
            "content": "# üìã Logs Explorer\n\nExplorez les logs de tous vos namespaces via Loki.",
            "mode": "markdown"
          },
          "title": "",
          "type": "text"
        },
        {
          "datasource": {"type": "loki", "uid": "loki"},
          "gridPos": {"h": 20, "w": 24, "x": 0, "y": 3},
          "id": 2,
          "options": {
            "dedupStrategy": "none",
            "enableLogDetails": true,
            "prettifyLogMessage": false,
            "showCommonLabels": false,
            "showLabels": false,
            "showTime": true,
            "sortOrder": "Descending",
            "wrapLogMessage": false
          },
          "targets": [{"expr": "{namespace=\"$namespace\"} |= \"$search\"", "refId": "A"}],
          "title": "Logs",
          "type": "logs"
        }
      ],
      "refresh": "10s",
      "schemaVersion": 38,
      "style": "dark",
      "tags": ["data-platform", "logs", "loki"],
      "templating": {
        "list": [
          {
            "current": {"selected": false, "text": "vault", "value": "vault"},
            "datasource": {"type": "loki", "uid": "loki"},
            "definition": "label_values(namespace)",
            "hide": 0,
            "includeAll": false,
            "label": "Namespace",
            "multi": false,
            "name": "namespace",
            "options": [],
            "query": "label_values(namespace)",
            "refresh": 2,
            "regex": "",
            "skipUrlSync": false,
            "sort": 1,
            "type": "query"
          },
          {
            "current": {"selected": false, "text": "", "value": ""},
            "hide": 0,
            "label": "Search",
            "name": "search",
            "options": [{"selected": true, "text": "", "value": ""}],
            "query": "",
            "skipUrlSync": false,
            "type": "textbox"
          }
        ]
      },
      "time": {"from": "now-1h", "to": "now"},
      "timepicker": {},
      "timezone": "Europe/Paris",
      "title": "Data Platform - Logs Explorer",
      "uid": "data-platform-logs",
      "version": 1,
      "weekStart": "monday"
    }

---
# Dashboard Services Status
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-services
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
    app: grafana
data:
  services-status.json: |
    {
      "annotations": {"list": []},
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "id": null,
      "links": [],
      "liveNow": false,
      "panels": [
        {
          "gridPos": {"h": 3, "w": 24, "x": 0, "y": 0},
          "id": 1,
          "options": {
            "content": "# üîß Services Status\n\n√âtat des services de la Data Platform",
            "mode": "markdown"
          },
          "title": "",
          "type": "text"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [{"options": {"0": {"color": "red", "index": 1, "text": "DOWN"}, "1": {"color": "green", "index": 0, "text": "UP"}}, "type": "value"}], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]}}},
          "gridPos": {"h": 4, "w": 4, "x": 0, "y": 3},
          "id": 10,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "sum(kube_deployment_status_replicas_available{namespace=\"vault\", deployment=\"vault\"})", "refId": "A"}],
          "title": "üîê Vault",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [{"options": {"0": {"color": "red", "index": 1, "text": "DOWN"}, "1": {"color": "green", "index": 0, "text": "UP"}}, "type": "value"}], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]}}},
          "gridPos": {"h": 4, "w": 4, "x": 4, "y": 3},
          "id": 11,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "sum(kube_deployment_status_replicas_available{namespace=\"minio\", deployment=\"minio\"})", "refId": "A"}],
          "title": "üì¶ MinIO",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [{"options": {"0": {"color": "red", "index": 1, "text": "DOWN"}, "1": {"color": "green", "index": 0, "text": "UP"}}, "type": "value"}], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]}}},
          "gridPos": {"h": 4, "w": 4, "x": 8, "y": 3},
          "id": 12,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "sum(kube_statefulset_status_replicas_ready{namespace=\"harbor\", statefulset=~\"harbor.*\"})", "refId": "A"}],
          "title": "üê≥ Harbor",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [{"options": {"0": {"color": "red", "index": 1, "text": "DOWN"}, "1": {"color": "green", "index": 0, "text": "UP"}}, "type": "value"}], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]}}},
          "gridPos": {"h": 4, "w": 4, "x": 12, "y": 3},
          "id": 13,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "sum(kube_deployment_status_replicas_available{namespace=\"trino\"})", "refId": "A"}],
          "title": "üìä Trino",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [{"options": {"0": {"color": "red", "index": 1, "text": "DOWN"}, "1": {"color": "green", "index": 0, "text": "UP"}}, "type": "value"}], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]}}},
          "gridPos": {"h": 4, "w": 4, "x": 16, "y": 3},
          "id": 14,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "sum(kube_deployment_status_replicas_available{namespace=\"openmetadata\"})", "refId": "A"}],
          "title": "üìö OpenMetadata",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [{"options": {"0": {"color": "red", "index": 1, "text": "DOWN"}, "1": {"color": "green", "index": 0, "text": "UP"}}, "type": "value"}], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]}}},
          "gridPos": {"h": 4, "w": 4, "x": 20, "y": 3},
          "id": 15,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "targets": [{"expr": "sum(kube_deployment_status_replicas_available{namespace=\"argocd\"})", "refId": "A"}],
          "title": "üîÑ ArgoCD",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"unit": "bytes"}},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 7},
          "id": 20,
          "options": {},
          "targets": [{"expr": "sum(container_memory_usage_bytes{namespace=~\"vault|minio|harbor|trino|openmetadata|argocd\"}) by (namespace)", "legendFormat": "{{namespace}}", "refId": "A"}],
          "title": "Memory par Namespace",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {}},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 7},
          "id": 21,
          "options": {},
          "targets": [{"expr": "sum(rate(container_cpu_usage_seconds_total{namespace=~\"vault|minio|harbor|trino|openmetadata|argocd\"}[5m])) by (namespace)", "legendFormat": "{{namespace}}", "refId": "A"}],
          "title": "CPU par Namespace",
          "type": "timeseries"
        }
      ],
      "refresh": "30s",
      "schemaVersion": 38,
      "style": "dark",
      "tags": ["data-platform", "services"],
      "templating": {"list": []},
      "time": {"from": "now-1h", "to": "now"},
      "timepicker": {},
      "timezone": "Europe/Paris",
      "title": "Data Platform - Services Status",
      "uid": "data-platform-services",
      "version": 1,
      "weekStart": "monday"
    }

