postgresql:
  global:
    storageClass: local-path
  auth:
    postgresPassword: "postgrespassword"
    username: "admin"
    password: "adminpassword"
  image:
    registry: public.ecr.aws
    repository: bitnami/postgresql
    tag: "16"
  primary:
    persistence:
      size: 50Gi  # desired size; existing PVC may stay smaller on local-path
    initdbScripts:
      init.sql: |
        -- =============================================================================
        -- AIRFLOW DATABASE
        -- =============================================================================
        CREATE DATABASE airflow_db;
        CREATE USER airflow_user WITH PASSWORD 'airflow_pass';
        GRANT ALL PRIVILEGES ON DATABASE airflow_db TO airflow_user;
        ALTER DATABASE airflow_db OWNER TO airflow_user;
        \c airflow_db
        GRANT ALL ON SCHEMA public TO airflow_user;

        -- =============================================================================
        -- OPENMETADATA DATABASE
        -- =============================================================================
        \c postgres
        CREATE DATABASE openmetadata_db;
        CREATE USER openmetadata_user WITH PASSWORD 'openmetadata_password';
        GRANT ALL PRIVILEGES ON DATABASE openmetadata_db TO openmetadata_user;
        ALTER DATABASE openmetadata_db OWNER TO openmetadata_user;
        \c openmetadata_db
        GRANT ALL ON SCHEMA public TO openmetadata_user;

        -- =============================================================================
        -- HARBOR DATABASE
        -- =============================================================================
        \c postgres
        CREATE DATABASE harbor_db;
        CREATE USER harbor_user WITH PASSWORD 'harbor_password';
        GRANT ALL PRIVILEGES ON DATABASE harbor_db TO harbor_user;
        ALTER DATABASE harbor_db OWNER TO harbor_user;
        \c harbor_db
        GRANT ALL ON SCHEMA public TO harbor_user;

        -- =============================================================================
        -- NESSIE DATABASE (for Iceberg catalog metadata)
        -- =============================================================================
        \c postgres
        CREATE DATABASE nessie_db;
        CREATE USER nessie_user WITH PASSWORD 'nessie_password';
        GRANT ALL PRIVILEGES ON DATABASE nessie_db TO nessie_user;
        ALTER DATABASE nessie_db OWNER TO nessie_user;
        \c nessie_db
        GRANT ALL ON SCHEMA public TO nessie_user;

    networkPolicy:
      enabled: false  # We will manage our own custom NetPol for more precision
