# HashiCorp Vault Helm Chart Values
# Chart: hashicorp/vault

global:
  enabled: true
  tlsDisable: true  # Dev mode
  serverTelemetry:
    prometheusOperator: false
  psp:
    enable: false

# Désactiver l'injecteur pour éviter les problèmes de webhook
injector:
  enabled: false

server:
  enabled: true
  # Dev Mode (pour POC/développement)
  dev:
    enabled: true
    devRootToken: "root"
  
  # Image (Harbor registry)
  image:
    repository: 10.10.0.101:30500/data-platform/vault
    tag: "1.15.2"
    pullPolicy: IfNotPresent
  
  imagePullSecrets:
    - name: harbor-registry
  
  # Resources
  resources:
    requests:
      memory: 256Mi
      cpu: 250m
    limits:
      memory: 512Mi
      cpu: 500m
  
  # ServiceAccount
  serviceAccount:
    create: true
    name: "vault"

  # Probes
  readinessProbe:
    enabled: true
    path: "/v1/sys/health?standbyok=true"
    port: 8200
  livenessProbe:
    enabled: true
    path: "/v1/sys/health?standbyok=true"
    port: 8200
    initialDelaySeconds: 60
  startupProbe:
    enabled: true
    port: 8200

  # Network Policy
  networkPolicy:
    enabled: false

  # Auth Delegator
  authDelegator:
    enabled: true

  # Ingress
  ingress:
    enabled: false
  
  # Service
  service:
    enabled: true
    type: NodePort
    port: 8200
    targetPort: 8200
    nodePort: 30820
    instanceSelector:
      enabled: false
  
  # Data Storage (pour mode non-dev)
  dataStorage:
    enabled: false  # Désactivé en mode dev
    size: 10Gi
    storageClass: longhorn
    accessMode: ReadWriteOnce
  
  # Audit Storage
  auditStorage:
    enabled: false
  
  # HA Configuration (pour production)
  ha:
    enabled: false
    replicas: 3
    raft:
      enabled: false

  # Enterprise License
  enterpriseLicense:
    secretName: ""
  
  # Standalone config (pour mode non-dev)
  standalone:
    enabled: false
    config: |
      ui = true
      
      listener "tcp" {
        tls_disable = 1
        address = "[::]:8200"
        cluster_address = "[::]:8201"
      }
      
      storage "file" {
        path = "/vault/data"
      }

  # StatefulSet
  statefulSet:
    securityContext:
      pod: {}
      container: {}

# UI
ui:
  enabled: false

# CSI Provider
csi:
  enabled: false

serverTelemetry:
  serviceMonitor:
    enabled: false
  prometheusRules:
    enabled: false
    rules: []
