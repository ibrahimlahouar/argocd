# =============================================================================
# DATABASE BACKUPS - Configuration
# =============================================================================
# Ce chart crée des CronJobs pour sauvegarder automatiquement les bases de données
# de la Data Platform. Les backups sont stockés sur MinIO.
# =============================================================================

# Configuration globale
global:
  # Namespace où déployer les jobs de backup
  namespace: velero
  
  # Configuration MinIO pour le stockage des backups
  minio:
    endpoint: "minio.minio.svc:9000"
    bucket: "db-backups"
    accessKey: "minio"
    secretKey: "minio123"  # À mettre dans un secret en production

# -----------------------------------------------------------------------------
# MYSQL BACKUP - DISABLED (Migrated to PostgreSQL)
# -----------------------------------------------------------------------------
mysql:
  enabled: false  # MySQL n'est plus utilisé - tout migré vers PostgreSQL

# -----------------------------------------------------------------------------
# POSTGRESQL BACKUP (All Services: Airflow, OpenMetadata, Harbor, Nessie)
# -----------------------------------------------------------------------------
postgresql:
  enabled: true
  # Cron schedule: tous les jours à 2h du matin
  schedule: "0 2 * * *"
  
  # Configuration de connexion - postgres-shared
  host: "postgres-shared-postgresql.infra.svc"
  port: 5432
  databases:
    - airflow_db
    - openmetadata_db
    - harbor_db
    - nessie_db
  
  # Credentials (référence au secret postgres-shared)
  credentials:
    secretName: "postgres-shared-secrets"
    usernameKey: "admin"
    passwordKey: "admin-password"
  
  # Rétention
  retention:
    days: 30
    copies: 30
  
  # Ressources
  resources:
    requests:
      cpu: "100m"
      memory: "256Mi"
    limits:
      cpu: "500m"
      memory: "512Mi"

# -----------------------------------------------------------------------------
# IMAGE CONFIGURATION
# -----------------------------------------------------------------------------
images:
  postgresql:
    repository: public.ecr.aws/bitnami/postgresql
    tag: "16"
  minio:
    repository: minio/mc
    tag: "latest"
