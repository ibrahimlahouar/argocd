# Trino Helm Chart Values
# Chart: trino/trino ou custom

# Image
image:
  repository: 10.10.0.101:30500/data-platform/trino
  tag: "432"
  pullPolicy: IfNotPresent

# ImagePullSecrets
imagePullSecrets:
  - name: harbor-registry

# Server Configuration
server:
  workers: 2
  coordinatorExtraConfig: ""
  node:
    environment: production
    dataDir: /data/trino
    pluginDir: /usr/lib/trino/plugin
  
  workerExtraConfig: ""
  
  exchangeManager:
    name: "filesystem"
    baseDir: "/tmp/trino-local-file-system-exchange-manager"

  log:
    trino:
      level: INFO
  config:
    path: /etc/trino
    authenticationType: ""
    http:
      port: 8080
    https:
      enabled: false
    query:
      maxMemory: "50GB"
      maxMemoryPerNode: "10GB"
      maxTotalMemoryPerNode: "12GB"
  autoscaling:
    enabled: false

# Coordinator Configuration
coordinator:
  jvm:
    maxHeapSize: "4G"
    gcMethod:
      type: "UseG1GC"
      g1:
        heapRegionSize: "32M"
  config:
    memory:
      heapHeadroomPerNode: ""
    query:
      maxMemoryPerNode: "2GB"
  resources:
    requests:
      memory: "6Gi"
      cpu: "1000m"
    limits:
      memory: "8Gi"
      cpu: "2000m"
  livenessProbe:
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 6
    successThreshold: 1
  readinessProbe:
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 6
    successThreshold: 1

# Worker Configuration
worker:
  jvm:
    maxHeapSize: "4G"
    gcMethod:
      type: "UseG1GC"
      g1:
        heapRegionSize: "32M"
  config:
    memory:
      heapHeadroomPerNode: ""
    query:
      maxMemoryPerNode: "2GB"
  resources:
    requests:
      memory: "6Gi"
      cpu: "1000m"
    limits:
      memory: "8Gi"
      cpu: "2000m"
  livenessProbe:
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 6
    successThreshold: 1
  readinessProbe:
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 6
    successThreshold: 1

# Service
service:
  type: NodePort
  port: 8080
  nodePort: 30808

# Additional Catalogs
additionalCatalogs:
  # Iceberg with Nessie catalog
  iceberg: |
    connector.name=iceberg
    iceberg.catalog.type=nessie
    iceberg.nessie-catalog.uri=http://nessie.nessie.svc:19120/api/v1
    iceberg.nessie-catalog.ref=main
    iceberg.file-format=PARQUET
    iceberg.nessie-catalog.warehouse-dir=s3://warehouse
    fs.native-s3.enabled=true
    s3.endpoint=http://minio.minio.svc:9000
    s3.path-style-access=true
    s3.aws-access-key=minioadmin
    s3.aws-secret-key=minioadmin123
  
  # PostgreSQL - OpenMetadata database
  postgresql_openmetadata: |
    connector.name=postgresql
    connection-url=jdbc:postgresql://postgres-shared-postgresql.infra.svc:5432/openmetadata_db
    connection-user=openmetadata_user
    connection-password=openmetadata_password
    case-insensitive-name-matching=true
  
  # PostgreSQL - Airflow database
  postgresql_airflow: |
    connector.name=postgresql
    connection-url=jdbc:postgresql://postgres-shared-postgresql.infra.svc:5432/airflow_db
    connection-user=airflow_user
    connection-password=airflow_pass
    case-insensitive-name-matching=true
  
  # PostgreSQL - Harbor database
  postgresql_harbor: |
    connector.name=postgresql
    connection-url=jdbc:postgresql://postgres-shared-postgresql.infra.svc:5432/harbor_db
    connection-user=harbor_user
    connection-password=harbor_password
    case-insensitive-name-matching=true
  
  # PostgreSQL - Nessie database
  postgresql_nessie: |
    connector.name=postgresql
    connection-url=jdbc:postgresql://postgres-shared-postgresql.infra.svc:5432/nessie_db
    connection-user=nessie_user
    connection-password=nessie_password
    case-insensitive-name-matching=true

# Security
auth:
  enabled: false

# Access Control
accessControl: {}

# Ingress
ingress:
  enabled: false

# ServiceAccount
serviceAccount:
  create: true
  name: trino

# Affinity
affinity: {}

# Node Selector
nodeSelector: {}

# Tolerations
tolerations: []

# Additional Node Properties
additionalNodeProperties: {}

# Additional Config Properties
additionalConfigProperties: {}

# Additional Log Properties
additionalLogProperties: {}

# Additional JVM Config
additionalJVMConfig: {}

shareProcessNamespace:
  coordinator: false
  worker: false

initContainers:
  coordinator: []
  worker: []

kafka:
  mountPath: "/etc/trino/schemas"

sidecarContainers:
  coordinator: []
  worker: []
