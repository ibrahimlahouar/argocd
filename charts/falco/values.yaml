# =============================================================================
# FALCO - Runtime Security
# =============================================================================
# Falco détecte les comportements suspects au runtime:
# - Exécution de shell dans un container
# - Lecture de fichiers sensibles (/etc/shadow, etc.)
# - Connexions réseau suspectes
# - Escalade de privilèges
# =============================================================================

falco:
  # Driver pour capturer les syscalls
  driver:
    enabled: true
    kind: modern_ebpf  # Utilise eBPF moderne (meilleure performance)
  
  # Collecteurs
  collectors:
    enabled: true
    containerd:
      enabled: true
      socket: /run/containerd/containerd.sock
    crio:
      enabled: false
    docker:
      enabled: false
  
  # Configuration Falco
  falco:
    # Niveau de log
    log_level: info
    
    # Output des alertes
    json_output: true
    json_include_output_property: true
    
    # Règles
    rules_file:
      - /etc/falco/falco_rules.yaml
      - /etc/falco/falco_rules.local.yaml
      - /etc/falco/rules.d
    
    # Rate limiting
    outputs_queue:
      capacity: 2048
  
  # Règles personnalisées désactivées pour l'instant
  # Les règles par défaut de Falco sont suffisantes
  customRules: {}
  
  # Falcosidekick pour les alertes
  falcosidekick:
    enabled: true
    
    config:
      # Envoyer à AlertManager
      alertmanager:
        hostport: "http://monitoring-kube-prometheus-alertmanager.monitoring.svc:9093"
        minimumpriority: "warning"
      
      # Webhook (optionnel)
      # webhook:
      #   address: "http://your-webhook"
    
    # Resources
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 128Mi
  
  # Resources pour Falco
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  
  # ServiceMonitor
  serviceMonitor:
    enabled: true
  
  # Tolérations pour tous les nodes
  tolerations:
    - effect: NoSchedule
      operator: Exists
    - effect: NoExecute
      operator: Exists

