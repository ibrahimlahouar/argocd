airflowChart:
  # Kubernetes API (for KubernetesExecutor)
  kubeAPI:
    serviceIP: "10.233.0.1"
    port: 443
  airflow:
    image:
      repository: apache/airflow
      tag: 2.7.3-python3.10
      pullPolicy: IfNotPresent

    executor: KubernetesExecutor
    
    # Packages needed for the crypto DAG (S3/MinIO, HTTP requests, Kubernetes API)
    extraPipPackages:
      - "boto3>=1.28.0"
      - "requests>=2.31.0"
      - "kubernetes>=28.1.0"
        
    config:
      AIRFLOW__API__AUTH_BACKENDS: "airflow.api.auth.backend.session,airflow.api.auth.backend.basic_auth"
      AIRFLOW__WEBSERVER__EXPOSE_CONFIG: "True"

    users:
    - username: admin
      password: admin
      role: Admin
      email: admin@example.com
      firstName: Admin
      lastName: User

  web:
    service:
      type: NodePort
      nodePort:
        http: 32180

  postgresql:
    enabled: false

  externalDatabase:
    type: postgres
    host: postgres-shared-postgresql.infra.svc.cluster.local
    port: 5432
    database: airflow_db
    user: airflow_user
    passwordSecret: postgres-shared-secrets
    passwordSecretKey: airflow-password

  serviceAccount:
    create: true
    name: "airflow"

  dags:
    persistence:
      enabled: false
    gitSync:
      enabled: true
      repo: "https://github.com/ibrahimlahouar/airflow-dags.git"
      branch: "main"
      subPath: ""
      # public repo -> no credentials required
      sshSecret: ""
      httpSecret: ""

  ingress:
    enabled: true
    web:
      path: ""
      host: "airflow.data-platform.local"
      annotations:
        kubernetes.io/ingress.class: nginx
  
  logs:
    persistence:
      enabled: false

  scheduler:
    logCleanup:
      enabled: false

  workers:
    enabled: false
    logCleanup:
      enabled: false

  # Enable migration job explicitly
  migrateDatabaseJob:
    enabled: true
    jobAnnotations:
      "argocd.argoproj.io/hook": "PreSync"
      "argocd.argoproj.io/hook-delete-policy": "BeforeHookCreation"

  redis:
    enabled: false

  flower:
    enabled: false

  pgbouncer:
    enabled: false
