# =============================================================================
# CLUSTER ROLES - Rôles globaux pour la Data Platform
# =============================================================================

---
# Platform Admin - Accès complet à tous les namespaces de la plateforme
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: data-platform-admin
  labels:
    app.kubernetes.io/part-of: data-platform
    rbac.data-platform/role: admin
rules:
  # Accès complet aux pods
  - apiGroups: [""]
    resources: ["pods", "pods/log", "pods/exec", "pods/portforward"]
    verbs: ["*"]
  
  # Accès complet aux services
  - apiGroups: [""]
    resources: ["services", "endpoints"]
    verbs: ["*"]
  
  # Accès complet aux configmaps et secrets
  - apiGroups: [""]
    resources: ["configmaps", "secrets"]
    verbs: ["*"]
  
  # Accès complet aux PVCs
  - apiGroups: [""]
    resources: ["persistentvolumeclaims"]
    verbs: ["*"]
  
  # Accès complet aux deployments, statefulsets, daemonsets
  - apiGroups: ["apps"]
    resources: ["deployments", "statefulsets", "daemonsets", "replicasets"]
    verbs: ["*"]
  
  # Accès complet aux jobs et cronjobs
  - apiGroups: ["batch"]
    resources: ["jobs", "cronjobs"]
    verbs: ["*"]
  
  # Accès complet aux ingresses
  - apiGroups: ["networking.k8s.io"]
    resources: ["ingresses", "networkpolicies"]
    verbs: ["*"]
  
  # Accès complet aux HPA
  - apiGroups: ["autoscaling"]
    resources: ["horizontalpodautoscalers"]
    verbs: ["*"]
  
  # Accès aux CRDs de la plateforme
  - apiGroups: ["sparkoperator.k8s.io"]
    resources: ["*"]
    verbs: ["*"]
  
  - apiGroups: ["monitoring.coreos.com"]
    resources: ["*"]
    verbs: ["*"]
  
  - apiGroups: ["cert-manager.io"]
    resources: ["*"]
    verbs: ["*"]

---
# Developer - Accès lecture + certaines actions (pas de secrets)
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: data-platform-developer
  labels:
    app.kubernetes.io/part-of: data-platform
    rbac.data-platform/role: developer
rules:
  # Lecture des pods + logs
  - apiGroups: [""]
    resources: ["pods", "pods/log"]
    verbs: ["get", "list", "watch"]
  
  # Exec dans les pods (pour debug)
  - apiGroups: [""]
    resources: ["pods/exec"]
    verbs: ["create"]
  
  # Lecture des services
  - apiGroups: [""]
    resources: ["services", "endpoints"]
    verbs: ["get", "list", "watch"]
  
  # Lecture des configmaps (pas secrets!)
  - apiGroups: [""]
    resources: ["configmaps"]
    verbs: ["get", "list", "watch"]
  
  # Lecture des PVCs
  - apiGroups: [""]
    resources: ["persistentvolumeclaims"]
    verbs: ["get", "list", "watch"]
  
  # Lecture des deployments, etc.
  - apiGroups: ["apps"]
    resources: ["deployments", "statefulsets", "daemonsets", "replicasets"]
    verbs: ["get", "list", "watch"]
  
  # Gestion des jobs (pour lancer des Spark jobs)
  - apiGroups: ["batch"]
    resources: ["jobs", "cronjobs"]
    verbs: ["get", "list", "watch", "create", "delete"]
  
  # Lecture des ingresses
  - apiGroups: ["networking.k8s.io"]
    resources: ["ingresses"]
    verbs: ["get", "list", "watch"]
  
  # Gestion des Spark applications
  - apiGroups: ["sparkoperator.k8s.io"]
    resources: ["sparkapplications", "scheduledsparkapplications"]
    verbs: ["get", "list", "watch", "create", "update", "delete"]
  
  # Lecture du monitoring
  - apiGroups: ["monitoring.coreos.com"]
    resources: ["*"]
    verbs: ["get", "list", "watch"]

---
# Viewer - Accès lecture seule
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: data-platform-viewer
  labels:
    app.kubernetes.io/part-of: data-platform
    rbac.data-platform/role: viewer
rules:
  # Lecture des pods et logs
  - apiGroups: [""]
    resources: ["pods", "pods/log"]
    verbs: ["get", "list", "watch"]
  
  # Lecture des services
  - apiGroups: [""]
    resources: ["services", "endpoints"]
    verbs: ["get", "list", "watch"]
  
  # Lecture des configmaps (pas secrets!)
  - apiGroups: [""]
    resources: ["configmaps"]
    verbs: ["get", "list", "watch"]
  
  # Lecture des PVCs
  - apiGroups: [""]
    resources: ["persistentvolumeclaims"]
    verbs: ["get", "list", "watch"]
  
  # Lecture des deployments, etc.
  - apiGroups: ["apps"]
    resources: ["deployments", "statefulsets", "daemonsets", "replicasets"]
    verbs: ["get", "list", "watch"]
  
  # Lecture des jobs
  - apiGroups: ["batch"]
    resources: ["jobs", "cronjobs"]
    verbs: ["get", "list", "watch"]
  
  # Lecture des ingresses
  - apiGroups: ["networking.k8s.io"]
    resources: ["ingresses"]
    verbs: ["get", "list", "watch"]
  
  # Lecture des Spark applications
  - apiGroups: ["sparkoperator.k8s.io"]
    resources: ["sparkapplications", "scheduledsparkapplications"]
    verbs: ["get", "list", "watch"]
  
  # Lecture du monitoring
  - apiGroups: ["monitoring.coreos.com"]
    resources: ["*"]
    verbs: ["get", "list", "watch"]

